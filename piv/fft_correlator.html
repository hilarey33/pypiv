
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Class for the FFT correlator &#8212; pypiv a1 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Peak detection algorithms" href="peak_detection.html" />
    <link rel="prev" title="Class for grid specifications" href="grid_spec.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="peak_detection.html" title="Peak detection algorithms"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="grid_spec.html" title="Class for grid specifications"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pypiv a1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="grid_spec.html"
                        title="previous chapter">Class for grid specifications</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="peak_detection.html"
                        title="next chapter">Peak detection algorithms</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/piv/fft_correlator.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="class-for-the-fft-correlator">
<h1>Class for the FFT correlator<a class="headerlink" href="#class-for-the-fft-correlator" title="Permalink to this headline">¶</a></h1>
<p>For calculating the correlation with fast Fourier Transform (FFT) a class is set up.</p>
<dl class="class">
<dt id="piv.fft_correlator.FFTCorrelator">
<em class="property">class </em><code class="descclassname">piv.fft_correlator.</code><code class="descname">FFTCorrelator</code><span class="sig-paren">(</span><em>window_a_size</em>, <em>window_b_size</em>, <em>scale_fft='default'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator" title="Permalink to this definition">¶</a></dt>
<dd><p>An FFT Correlation Class for a PIV Evaluation of two frames
It uses the <a class="reference external" href="https://hgomersall.github.io/pyFFTW/">pyfftw</a> library for performant FFT.
This class is also responsible for calculating the Shift after the correlation.</p>
<p>Initialize fftw objects for FFTs with the pyfftw library</p>
<p>The necessary functions are loaded and memory allocated.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>window_a_size</strong> – size of the interrogation window</li>
<li><strong>window_b_size</strong> – size of the search window</li>
<li><strong>scale_fft</strong> (<em>str</em>) – if set to upscale, the padding will be upscaled</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the window size does not meet the needs of the FFT function, the windows get padded with zeros.</p>
<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator._set_padding">
<code class="descclassname">FFTCorrelator.</code><code class="descname">_set_padding</code><span class="sig-paren">(</span><em>windows_size</em>, <em>scale_fft</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator._set_padding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator._set_padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Set zero padding size for FFTs</p>
</dd></dl>

<p>By calling the function for the getting the displacement the correlation is performed as well</p>
<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator.get_displacement">
<code class="descclassname">FFTCorrelator.</code><code class="descname">get_displacement</code><span class="sig-paren">(</span><em>window_a</em>, <em>window_b</em>, <em>subpixel_method='gaussian'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator.get_displacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator.get_displacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the displacement out of correlation.</p>
<p>First the correlation is performed and afterwards the shift is calculated.
For the displacement calculation the function</p>
<dl class="function">
<dt id="piv.peak_detection.FFTCorrelator.find_peak">
<code class="descname">find_peak</code><span class="sig-paren">(</span><em>corr</em>, <em>method='gaussian'</em><span class="sig-paren">)</span><a class="headerlink" href="#piv.peak_detection.FFTCorrelator.find_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Peak detection algorithm switch</p>
<p>After loading the correlation window an maximum finder is invoked.
The correlation window is cut down to the necessary 9 points around the maximum.
Afterwards the maximum is checked not to be close to the boarder of the correlation frame.
This cropped window is used in along with the chosen method to interpolate the sub pixel shift.
Each interpolation method returns a tuple with the sub pixel shift in x and y direction.
The maximums position and the sub pixel shift are added and returned.
If an error occurred during the sub pixel interpolation the shift is set to nan.
Also if the interpolation method is unknown an exception in thrown.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>corr</strong> – correlation window</li>
<li><strong>method</strong> – peak finder algorithm (gaussian, centroid, parabolic, 9point)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first">Sub pixel interpolation method not found</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">shift in interrogation window</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>is called with the subpixel_method passed on as parameter.
If a padding was needed, it is removed from the calculated displacement.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_a</strong> – interrogation window</li>
<li><strong>window_b</strong> – search window</li>
<li><strong>subpixel_method</strong> (<em>str</em>) – method for peak finder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">shift in x and y direction as tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator._evaluate_windows">
<code class="descclassname">FFTCorrelator.</code><code class="descname">_evaluate_windows</code><span class="sig-paren">(</span><em>window_a</em>, <em>window_b</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator._evaluate_windows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator._evaluate_windows" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the FFT of both windows, correlate and transform back.</p>
<p>In order to decrease the error a mean subtraction is performed.
To compensate for the indexing during the FFT a FFT Shift is performed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_a</strong> – interrogation window</li>
<li><strong>window_b</strong> – search window</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">correlation window</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="peak_detection.html" title="Peak detection algorithms"
             >next</a> |</li>
        <li class="right" >
          <a href="grid_spec.html" title="Class for grid specifications"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pypiv a1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, Jonas Ruebsam, Axel Rosenthal, Kevin Luedemann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>