<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Class for the FFT correlator &#8212; pypiv a1 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/my-styles.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Peak detection algorithms" href="peak_detection.html" />
    <link rel="prev" title="Class for grid specifications" href="grid_spec.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          PyPIV</a>
        <span class="navbar-text navbar-version pull-left"><b>1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../examples.html">Examples</a></li>
                <li><a href="../api.html">Documentation</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">PyPIV Docs <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="direct_piv.html">Class for direct Piv</a></li>
<li class="toctree-l1"><a class="reference internal" href="grid_spec.html">Class for grid specifications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Class for the FFT correlator</a></li>
<li class="toctree-l1"><a class="reference internal" href="peak_detection.html">Peak detection algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="adaptiv_piv.html">Class for adaptiv Piv</a></li>
<li class="toctree-l1"><a class="reference internal" href="velocity_scaler.html">Class for scaling the velocity field</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolator.html">Cubic interpolator</a></li>
<li class="toctree-l1"><a class="reference internal" href="grid_deformator.html">Grid deformator class</a></li>
<li class="toctree-l1"><a class="reference internal" href="velofilter.html">Velocity Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Filters for outlier detection</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Class for the FFT correlator</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="grid_spec.html" title="Previous Chapter: Class for grid specifications"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Class for gri...</span>
    </a>
  </li>
  <li>
    <a href="peak_detection.html" title="Next Chapter: Peak detection algorithms"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Peak detectio... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../_sources/piv/fft_correlator.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="class-for-the-fft-correlator">
<h1>Class for the FFT correlator<a class="headerlink" href="#class-for-the-fft-correlator" title="Permalink to this headline">¶</a></h1>
<p>For calculating the correlation with fast Fourier Transform (FFT) a class is set up.</p>
<dl class="class">
<dt id="piv.fft_correlator.FFTCorrelator">
<em class="property">class </em><code class="descclassname">piv.fft_correlator.</code><code class="descname">FFTCorrelator</code><span class="sig-paren">(</span><em>window_a_size</em>, <em>window_b_size</em>, <em>scale_fft='default'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator" title="Permalink to this definition">¶</a></dt>
<dd><p>An FFT Correlation Class for a PIV Evaluation of two frames
It uses the <a class="reference external" href="https://hgomersall.github.io/pyFFTW/">pyfftw</a> library for performant FFT.
This class is also responsible for calculating the Shift after the correlation.</p>
<p>Initialize fftw objects for FFTs with the pyfftw library</p>
<p>The necessary functions are loaded and memory allocated.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>window_a_size</strong> – size of the interrogation window</li>
<li><strong>window_b_size</strong> – size of the search window</li>
<li><strong>scale_fft</strong> (<em>str</em>) – if set to upscale, the padding will be upscaled</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>If the window size does not meet the needs of the FFT function, the windows get padded with zeros.</p>
<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator._set_padding">
<code class="descclassname">FFTCorrelator.</code><code class="descname">_set_padding</code><span class="sig-paren">(</span><em>windows_size</em>, <em>scale_fft</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator._set_padding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator._set_padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Set zero padding size for FFTs</p>
</dd></dl>

<p>By calling the function for the getting the displacement the correlation is performed as well</p>
<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator.get_displacement">
<code class="descclassname">FFTCorrelator.</code><code class="descname">get_displacement</code><span class="sig-paren">(</span><em>window_a</em>, <em>window_b</em>, <em>subpixel_method='gaussian'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator.get_displacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator.get_displacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute the displacement out of correlation.</p>
<p>First the correlation is performed and afterwards the shift is calculated.
For the displacement calculation the function</p>
<dl class="function">
<dt id="piv.peak_detection.FFTCorrelator.find_peak">
<code class="descname">find_peak</code><span class="sig-paren">(</span><em>corr</em>, <em>method='gaussian'</em><span class="sig-paren">)</span><a class="headerlink" href="#piv.peak_detection.FFTCorrelator.find_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Peak detection algorithm switch</p>
<p>After loading the correlation window an maximum finder is invoked.
The correlation window is cut down to the necessary 9 points around the maximum.
Afterwards the maximum is checked not to be close to the boarder of the correlation frame.
This cropped window is used in along with the chosen method to interpolate the sub pixel shift.
Each interpolation method returns a tuple with the sub pixel shift in x and y direction.
The maximums position and the sub pixel shift are added and returned.
If an error occurred during the sub pixel interpolation the shift is set to nan.
Also if the interpolation method is unknown an exception in thrown.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>corr</strong> – correlation window</li>
<li><strong>method</strong> – peak finder algorithm (gaussian, centroid, parabolic, 9point)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first">Sub pixel interpolation method not found</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">shift in interrogation window</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>is called with the subpixel_method passed on as parameter.
If a padding was needed, it is removed from the calculated displacement.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_a</strong> – interrogation window</li>
<li><strong>window_b</strong> – search window</li>
<li><strong>subpixel_method</strong> (<em>str</em>) – method for peak finder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">shift in x and y direction as tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="piv.fft_correlator.FFTCorrelator._evaluate_windows">
<code class="descclassname">FFTCorrelator.</code><code class="descname">_evaluate_windows</code><span class="sig-paren">(</span><em>window_a</em>, <em>window_b</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/piv/fft_correlator.html#FFTCorrelator._evaluate_windows"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#piv.fft_correlator.FFTCorrelator._evaluate_windows" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the FFT of both windows, correlate and transform back.</p>
<p>In order to decrease the error a mean subtraction is performed.
To compensate for the indexing during the FFT a FFT Shift is performed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>window_a</strong> – interrogation window</li>
<li><strong>window_b</strong> – search window</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">correlation window</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016-2017, Jonas Ruebsam, Axel Rosenthal, Kevin Luedemann.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>